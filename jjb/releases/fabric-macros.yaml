- scm:
    name: hyperledger-fabric-baseimage
    scm:
       - git:
            url: 'ssh://hyperledger-jobbuilder@gerrit.hyperledger.org:29418/fabric-baseimage'
            branches:
               - 'origin/$GERRIT_BRANCH'
            wipe-workspace: true
            credentials-id: '{credentials-id}'
            refspec: '$GERRIT_REFSPEC'
            choosing-strategy: 'gerrit'

- builder:
    name: baseimage-clean-environment
    builders:
      - shell: |
           #!/bin/bash -exu
           set -o pipefail

           make clean || true
           docker rmi -f $(docker images | grep dev | awk '{print $3}') || true
           docker rmi -f $(docker images | grep none | awk '{print $3}') || true
           docker rm -f $(docker ps -aq) || true
           docker rmi -f $(docker images | grep hyperledger/fabric-baseimage:*) || true

- builder:
    name: baseimage-release
    builders:
       - shell:
           !include-raw: include-raw-fabric-baseimage.sh

- builder:
    name: fabric-vagrant-release
    builders:
       - shell: |
           #!/bin/bash -exu
           set -o pipefail

           make vagrant

- builder:
    name: fabric-vagrant-local
    builders:
       - shell: |
           #!/bin/bash -exu
           set -o pipefail

           mkdir -p $WORKSPACE/packer_cache/
           cp /opt/6faef0530a81c47962bca6fc7945f1388dd0653f3e59903f3b153442bb0ebbb5.iso $WORKSPACE/packer_cache/
           make vagrant-local

- builder:
    name: fabric-docker-release
    builders:
       - shell: |
          #!/bin/bash -exu
          set -o pipefail

          make docker

- builder:
    name: fabric-docker-local
    builders:
       - shell: |
          #!/bin/bash -exu
          set -o pipefail

          make docker-local

